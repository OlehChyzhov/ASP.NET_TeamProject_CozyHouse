@model ShelterPetPublication
@{
    ViewBag.Title = "Edit Pet Publication";
    Guid userId = Guid.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value!);
}

<link rel="stylesheet" href="~/css/Shared/PetPublications/create_edit.css" asp-append-version="true" />

<form class="top-button">
    <button asp-area="Manager" asp-controller="PetPublication" asp-action="Index">Back to List</button>
</form>

<div class="page-layout-container">
    @* Renamed for clarity *@
    <div class="form-container">
        <form method="post" enctype="multipart/form-data" asp-area="Manager" asp-controller="PetPublication" asp-action="Edit" class="main-form">
            <input type="hidden" asp-for="Id" />

            <h1>Edit Pet Publication</h1>

            <h2>Publication Information</h2>
            <div>
                <input type="text" placeholder="Title" asp-for="PublicationTitle" />
            </div>
            <div>
                <textarea placeholder="Summary" asp-for="Summary"></textarea>
            </div>
            <div>
                <textarea placeholder="Description" asp-for="Description"></textarea>
            </div>
            <div>
                <input placeholder="Location" asp-for="Location" />
            </div>

            <h2>Pet Information</h2>
            <div>
                <input placeholder="Pet Name" asp-for="PetName" />
            </div>
            <div>
                <input placeholder="Pet Age" asp-for="PetAge" /> @* Consider type="number" *@
            </div>

            <div>
                <label asp-for="PetType">Pet Type:</label>
                <select asp-for="PetType">
                    @{
                        foreach (Species species in Enum.GetValues(typeof(Species)))
                        {
                            <option value="@species" selected="@(Model.PetType == species)">@species.ToString()</option>
                        }
                    }
                </select>
            </div>
            <div>
                <input placeholder="Breed" asp-for="Breed" />
            </div>

            <div class="checkbox-with-label">
                <input type="checkbox" asp-for="IsVaccinated" name="IsVaccinated" id="IsVaccinatedEdit" />
                <label for="IsVaccinatedEdit">Is Vaccinated?</label>
            </div>
            <div class="checkbox-with-label">
                <input type="checkbox" asp-for="IsSterilized" name="IsSterilized" id="IsSterilizedEdit" />
                <label for="IsSterilizedEdit">Is Sterilized?</label>
            </div>

            <div>
                <label for="newPetImagesInput">Upload new images (optional, will replace/add to existing based on backend logic):</label>
                <input type="file" name="newPetImages" id="newPetImagesInput" multiple onchange="previewSelectedImages(event)" />
            </div>

            <div>
                <button type="submit">Update Publication</button>
            </div>
        </form>
    </div>

    <div class="image-gallery-container">
        <h2>New Images Preview</h2>
        <div id="imagePreviewArea" class="image-preview-grid">
            <p class="no-images-text">No new images selected.</p>
        </div>

        @if (Model.Images != null && Model.Images.Any())
        {
            <h2>Current Images</h2>
            <div class="current-images-grid image-preview-grid">
                @foreach (var image in Model.Images)
                {
                    <div class="image-preview-item">
                        <img src="@image.ImageUrl" alt="Current pet image: @Model.PetName" />
                        @* Optionally, add a way to mark images for deletion here if your backend supports it *@
                    </div>
                }
            </div>
        }
        else
        {
            <h2>Current Images</h2>
            <p>No current images available for this publication.</p>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Same previewSelectedImages function as in Create.cshtml
        function previewSelectedImages(event) {
            const previewArea = document.getElementById('imagePreviewArea'); // Targets the new images preview
            const noImagesText = previewArea.querySelector('.no-images-text');
            previewArea.innerHTML = '';

            const files = event.target.files;
            if (files && files.length > 0) {
                Array.from(files).forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const imgContainer = document.createElement('div');
                            imgContainer.classList.add('image-preview-item');
                            const imgElement = document.createElement('img');
                            imgElement.src = e.target.result;
                            imgElement.alt = file.name;
                            imgContainer.appendChild(imgElement);
                            previewArea.appendChild(imgContainer);
                        }
                        reader.readAsDataURL(file);
                    }
                });
            } else {
                 previewArea.innerHTML = '<p class="no-images-text">No new images selected.</p>';
            }
        }
    </script>
}