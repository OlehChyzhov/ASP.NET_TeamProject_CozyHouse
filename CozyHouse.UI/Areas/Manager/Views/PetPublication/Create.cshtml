@model ShelterPetPublication
@* Inject IShelterPetPublicationRepository _petPublicationRepository - це зазвичай робиться в контролері, а не у View *@
@{
    ViewBag.Title = "Create New Pet Publication";
    Guid userId = Guid.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value!);
}
<link rel="stylesheet" href="~/css/Shared/PetPublications/create_edit.css" asp-append-version="true" />

<form class="top-button">
    <button asp-area="Manager" asp-controller="PetPublication" asp-action="Index">Back to List</button>
</form>

<div class="page-layout-container">
    <div class="form-container">
        <form method="post" enctype="multipart/form-data" asp-area="Manager" asp-controller="PetPublication" asp-action="Create"
              class="main-form">
            <h1>New Pet Publication</h1>

            <h2>Publication Information</h2>
            <div>
                <label asp-for="PublicationTitle">Title</label>
                <input type="text" placeholder="Title" asp-for="PublicationTitle" />
            </div>
            <div>
                <label asp-for="Summary">Summary</label>
                <textarea placeholder="Summary" asp-for="Summary"></textarea>
            </div>
            <div>
                <label asp-for="Description">Description</label>
                <textarea placeholder="Description" asp-for="Description"></textarea>
            </div>
            <div>
                <label asp-for="Location">Location</label>
                <input placeholder="Location" asp-for="Location" />
            </div>

            <h2>Pet Information</h2>
            <div>
                <label asp-for="PetName">Pet Name</label>
                <input placeholder="Pet Name" asp-for="PetName" />
            </div>
            <div>
                <label asp-for="PetAge">Pet Age</label>
                <input placeholder="Pet Age" asp-for="PetAge" /> @* Consider type="number" if appropriate *@
            </div>

            <div>
                <label asp-for="PetType">Pet Type:</label>
                <select asp-for="PetType">
                    @{
                        foreach (Species species in Enum.GetValues(typeof(Species)))
                        {
                            <option value="@species">@species.ToString()</option>
                        }
                    }
                </select>
            </div>
            <div>
                <label asp-for="Breed">Breed</label>
                <input placeholder="Breed" asp-for="Breed" />
            </div>

            <div class="checkbox-with-label">
                <input type="checkbox" asp-for="IsVaccinated" id="IsVaccinatedCreate" />
                <label for="IsVaccinatedCreate">Is Vaccinated?</label>
            </div>
            <div class="checkbox-with-label">
                <input type="checkbox" asp-for="IsSterilized" id="IsSterilizedCreate" />
                <label for="IsSterilizedCreate">Is Sterilized?</label>
            </div>

            <div>
                <label for="petImagesInput">Select pet images (multiple allowed):</label>
                @* У Create.cshtml name для файлів може бути petImages або newPetImages, узгодьте з вашим Create методом контролера *@
                <input type="file" name="petImages" id="petImagesInput" multiple required onchange="previewSelectedImagesForCreate(event)" />
            </div>

            <div>
                <button type="submit">Create Publication</button>
            </div>
        </form>
    </div>

    <div class="image-gallery-container">
        <h2>Image Preview</h2>
        <div id="imagePreviewAreaCreate" class="image-preview-grid">
            <p class="no-images-text">No images selected yet.</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function previewSelectedImagesForCreate(event) {
            const previewArea = document.getElementById('imagePreviewAreaCreate');
            previewArea.innerHTML = '';

            const files = event.target.files;
            if (files && files.length > 0) {
                 Array.from(files).forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const imgContainer = document.createElement('div');
                            imgContainer.classList.add('image-preview-item');
                            const imgElement = document.createElement('img');
                            imgElement.src = e.target.result;
                            imgElement.alt = file.name;
                            imgContainer.appendChild(imgElement);
                            previewArea.appendChild(imgContainer);
                        }
                        reader.readAsDataURL(file);
                    }
                });
            } else {
                 previewArea.innerHTML = '<p class="no-images-text">No images selected yet.</p>';
            }
        }
    </script>
}